<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive Infotainment Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #162447 50%, #1f4068 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: rgba(10, 14, 39, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }

        .greeting {
            font-size: 1.1em;
            color: #00ffff;
        }

        .status-info {
            display: flex;
            gap: 30px;
            align-items: center;
            color: #a0d8d8;
        }

        .time {
            font-size: 1.2em;
            font-weight: 600;
            color: #fff;
        }

        .date {
            font-size: 0.95em;
        }

        .app-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 40px;
        }

        .app-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .app-title h1 {
            font-size: 3em;
            font-weight: 300;
            letter-spacing: 3px;
            background: linear-gradient(90deg, #00ffff, #00d4ff, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .app-title .subtitle {
            color: #7fb3d5;
            font-size: 1em;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .main-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-btn {
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 16px;
            color: #a0d8d8;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 400;
            transition: all 0.4s ease;
            text-align: center;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 180, 255, 0.1));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .nav-btn:hover::before {
            opacity: 1;
        }

        .nav-btn:hover {
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3),
                        inset 0 0 20px rgba(0, 255, 255, 0.1);
            transform: translateY(-5px);
            color: #00ffff;
        }

        .nav-btn.active {
            background: rgba(0, 255, 255, 0.15);
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.4),
                        inset 0 0 30px rgba(0, 255, 255, 0.1);
        }

        .nav-icon {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }

        .loading {
            text-align: center;
            padding: 100px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(0, 255, 255, 0.1);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .genre-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .genre-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 25px;
            color: #a0d8d8;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .genre-tab:hover {
            border-color: rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
            color: #00ffff;
        }

        .genre-tab.active {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 255, 0.2);
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .item-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 50px rgba(0, 255, 255, 0.3),
                        inset 0 0 30px rgba(0, 255, 255, 0.05);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .item-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #1a1a3e 0%, #2a4858 100%);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            position: relative;
        }

        .thumbnail-wrapper {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a3e 0%, #2a4858 100%);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .thumbnail-retry {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 180, 216, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .thumbnail-retry:hover {
            background: rgba(0, 180, 216, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }

        .item-content {
            padding: 20px;
        }

        .item-title {
            font-size: 1.05em;
            font-weight: 500;
            margin-bottom: 8px;
            color: #fff;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .item-meta {
            color: #7fb3d5;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .item-description {
            font-size: 0.85em;
            color: #9eb8c5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.6;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b4d8, #0096c7);
            color: white;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
            background: linear-gradient(135deg, #00d4ff, #00b4d8);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #a0d8d8;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.4);
            color: #00ffff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            max-width: 1100px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 60px rgba(0, 255, 255, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2em;
            cursor: pointer;
            color: #7fb3d5;
            line-height: 1;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        .player-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .player-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .modal-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #00ffff;
            padding-right: 40px;
            letter-spacing: 1px;
        }

        .modal-meta {
            color: #7fb3d5;
            margin-bottom: 15px;
        }

        .no-content, .error {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            color: #7fb3d5;
            font-size: 1.1em;
        }

        .error {
            color: #ff6b6b;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 55px;
            height: 55px;
            background: rgba(0, 180, 216, 0.3);
            backdrop-filter: blur(10px);
            color: #00ffff;
            border: 1px solid rgba(0, 255, 255, 0.5);
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.6);
            background: rgba(0, 180, 216, 0.5);
        }

        @media (max-width: 768px) {
            .main-nav {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .status-info {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <div class="greeting">Welcome back, Media Explorer</div>
        <div class="status-info">
            <div class="time" id="currentTime">--:--</div>
            <div class="date" id="currentDate">Loading...</div>
        </div>
    </div>

    <div class="app-container">
        <div class="app-title">
            <h1>Archive Hub</h1>
            <div class="subtitle">Digital Entertainment System</div>
        </div>

        <nav class="main-nav" id="mainNav">
            <button class="nav-btn active" onclick="switchContent('movies')">
                <span class="nav-icon">🎬</span>
                Movies
            </button>
            <button class="nav-btn" onclick="switchContent('tv')">
                <span class="nav-icon">📺</span>
                TV Shows
            </button>
            <button class="nav-btn" onclick="switchContent('music')">
                <span class="nav-icon">🎵</span>
                Music
            </button>
            <button class="nav-btn" onclick="switchContent('audiobooks')">
                <span class="nav-icon">📚</span>
                Audiobooks
            </button>
            <button class="nav-btn" onclick="switchContent('radio')">
                <span class="nav-icon">📻</span>
                Radio
            </button>
            <button class="nav-btn" onclick="switchContent('podcasts')">
                <span class="nav-icon">🎙️</span>
                Podcasts
            </button>
        </nav>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <div>Loading content...</div>
        </div>

        <div id="contentContainer"></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <button id="backToTop" class="back-to-top" onclick="scrollToTop()" title="Back to top">↑</button>

    <script>
        // Update time and date
        function updateDateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            const dateStr = now.toLocaleDateString('en-US', { 
                weekday: 'long',
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('currentDate').textContent = dateStr;
        }
        
        updateDateTime();
        setInterval(updateDateTime, 1000);

        const CONTENT_TYPES = {
            movies: {
                name: 'Movies',
                query: 'mediatype:movies AND (collection:"feature_films" OR collection:"classic_cinema") AND language:English',
                genres: {
                    'Action': ['action', 'adventure', 'martial arts', 'war', 'western'],
                    'Comedy': ['comedy', 'slapstick', 'romantic comedy', 'satire'],
                    'Drama': ['drama', 'melodrama', 'historical drama'],
                    'Horror': ['horror', 'thriller', 'suspense', 'terror', 'monster'],
                    'Sci-Fi': ['science fiction', 'sci-fi', 'scifi', 'space', 'futuristic'],
                    'Mystery': ['mystery', 'detective', 'crime', 'noir', 'film noir'],
                    'Romance': ['romance', 'romantic', 'love story'],
                    'Animation': ['animation', 'animated', 'cartoon']
                }
            },
            tv: {
                name: 'TV Shows',
                query: 'mediatype:movies AND (collection:classic_tv OR collection:classic_tv_1970s OR collection:classic_tv_1960s)',
                genres: {
                    'Drama': ['drama', 'series'],
                    'Comedy': ['comedy', 'sitcom'],
                    'News': ['news', 'newscast'],
                    'Documentary': ['documentary', 'educational'],
                    'Talk Shows': ['talk show', 'interview'],
                    'Variety': ['variety', 'entertainment'],
                    'Classic TV': ['classic', 'vintage']
                }
            },
            music: {
                name: 'Music',
                query: 'mediatype:audio AND (collection:etree OR collection:audio_music OR collection:GratefulDead)',
                genres: {
                    'Rock': ['rock', 'rock and roll'],
                    'Jazz': ['jazz', 'swing'],
                    'Classical': ['classical', 'orchestra', 'symphony'],
                    'Blues': ['blues'],
                    'Folk': ['folk', 'acoustic'],
                    'Electronic': ['electronic', 'techno'],
                    'Live Concerts': ['live', 'concert', 'performance']
                }
            },
            audiobooks: {
                name: 'Audiobooks',
                query: 'mediatype:audio AND collection:audio_bookspoetry',
                genres: {
                    'Fiction': ['fiction', 'novel'],
                    'Classic Literature': ['classic', 'literature'],
                    'Poetry': ['poetry', 'poems'],
                    'Non-Fiction': ['non-fiction', 'nonfiction'],
                    'Children': ['children', 'kids', 'juvenile'],
                    'Mystery': ['mystery', 'detective'],
                    'Science Fiction': ['science fiction', 'sci-fi']
                }
            },
            radio: {
                name: 'Old Time Radio',
                query: 'mediatype:audio AND (collection:radioprograms OR collection:oldtimeradio)',
                genres: {
                    'Drama': ['drama', 'theater'],
                    'Comedy': ['comedy', 'humor'],
                    'Mystery': ['mystery', 'suspense'],
                    'Science Fiction': ['science fiction', 'sci-fi'],
                    'Adventure': ['adventure', 'action'],
                    'Horror': ['horror', 'thriller'],
                    'Western': ['western', 'frontier']
                }
            },
            podcasts: {
                name: 'Podcasts',
                query: 'mediatype:audio AND collection:podcasts',
                genres: {
                    'News': ['news', 'current events'],
                    'Technology': ['technology', 'tech', 'digital'],
                    'Education': ['education', 'educational'],
                    'Arts': ['arts', 'culture'],
                    'Science': ['science', 'research'],
                    'History': ['history', 'historical'],
                    'Politics': ['politics', 'political']
                }
            }
        };

        let currentContentType = 'movies';
        let contentData = {};

        async function fetchContent(type) {
            try {
                const config = CONTENT_TYPES[type];
                const url = `https://archive.org/advancedsearch.php?q=${encodeURIComponent(config.query)}&fl[]=identifier,title,description,year,subject,creator&sort[]=downloads+desc&rows=500&output=json`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                contentData[type] = {
                    items: data.response.docs,
                    categorized: categorizeContent(data.response.docs, config.genres)
                };
                
                return contentData[type];
            } catch (error) {
                console.error(`Error fetching ${type}:`, error);
                return null;
            }
        }

        function categorizeContent(items, genreMapping) {
            const categorized = {};
            
            Object.keys(genreMapping).forEach(genre => {
                categorized[genre] = [];
            });
            categorized['All'] = items;

            items.forEach(item => {
                let subjects = item.subject || [];
                if (!Array.isArray(subjects)) {
                    subjects = [subjects];
                }
                const subjectsLower = subjects.map(s => String(s).toLowerCase());
                
                for (const [genre, keywords] of Object.entries(genreMapping)) {
                    for (const keyword of keywords) {
                        if (subjectsLower.some(subject => subject.includes(keyword))) {
                            categorized[genre].push(item);
                            break;
                        }
                    }
                }
            });

            return categorized;
        }

        function renderContent(type) {
            const container = document.getElementById('contentContainer');
            const data = contentData[type];
            
            if (!data) {
                container.innerHTML = '<div class="error">Failed to load content. Please try again.</div>';
                return;
            }

            const config = CONTENT_TYPES[type];
            const genres = ['All', ...Object.keys(config.genres)];
            
            let html = `
                <div class="content-section active">
                    <div class="genre-tabs" id="genreTabs-${type}">
            `;
            
            genres.forEach(genre => {
                const count = data.categorized[genre]?.length || 0;
                if (count > 0) {
                    html += `<button class="genre-tab ${genre === 'All' ? 'active' : ''}" onclick="showGenre('${type}', '${genre}')">${genre} (${count})</button>`;
                }
            });
            
            html += `
                    </div>
                    <div id="itemsContainer-${type}"></div>
                </div>
            `;
            
            container.innerHTML = html;
            showGenre(type, 'All');
            
            // Setup lazy loading after content is rendered
            setTimeout(setupLazyLoading, 100);
        }

        function showGenre(type, genre) {
            const tabs = document.querySelectorAll(`#genreTabs-${type} .genre-tab`);
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.textContent.startsWith(genre));
            });

            const container = document.getElementById(`itemsContainer-${type}`);
            const items = contentData[type].categorized[genre] || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="no-content">No content found in this category</div>';
                return;
            }

            let html = '<div class="items-grid">';
            
            items.slice(0, 100).forEach(item => {
                html += createItemCard(item, type);
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Re-setup lazy loading for new images
            setTimeout(setupLazyLoading, 100);
        }

        function createItemCard(item, type) {
            const thumbnail = `https://archive.org/services/img/${item.identifier}`;
            const title = item.title || 'Untitled';
            const year = item.year || '';
            const creator = item.creator || '';
            const description = item.description ? 
                (Array.isArray(item.description) ? item.description[0] : item.description) : 
                'No description available';
            
            let metaInfo = '';
            if (year) metaInfo += `${year}`;
            if (creator && type === 'music') metaInfo += ` • ${Array.isArray(creator) ? creator[0] : creator}`;
            
            return `
                <div class="item-card">
                    <div class="thumbnail-wrapper" id="thumb-${item.identifier}">
                        <img src="${thumbnail}" 
                             alt="${title}" 
                             class="item-thumbnail" 
                             loading="lazy"
                             data-src="${thumbnail}"
                             data-retry-count="0"
                             onerror="handleImageError(this)">
                    </div>
                    <div class="item-content">
                        <div class="item-title">${escapeHtml(title)}</div>
                        ${metaInfo ? `<div class="item-meta">${escapeHtml(metaInfo)}</div>` : ''}
                        <div class="item-description">${escapeHtml(String(description).substring(0, 150))}...</div>
                        <div class="item-actions">
                            <button class="btn btn-primary" onclick="playItem('${item.identifier}', '${escapeHtml(title).replace(/'/g, "\\'")}', '${type}')">▶ Play</button>
                            <button class="btn btn-secondary" onclick="window.open('https://archive.org/details/${item.identifier}', '_blank')">Details</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function playItem(identifier, title, type) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h2 class="modal-title">${title}</h2>
                <div class="player-container">
                    <iframe src="https://archive.org/embed/${identifier}" allowfullscreen allow="autoplay"></iframe>
                </div>
                <div class="modal-meta">Streaming from Archive.org</div>
                <button class="btn btn-primary" onclick="window.open('https://archive.org/details/${identifier}', '_blank')">
                    View on Archive.org
                </button>
            `;
            
            modal.classList.add('active');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('active');
            document.getElementById('modalContent').innerHTML = '';
        }

        async function switchContent(type) {
            if (type === currentContentType) return;
            
            currentContentType = type;
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (!contentData[type]) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('contentContainer').innerHTML = '';
                
                await fetchContent(type);
                
                document.getElementById('loading').style.display = 'none';
            }
            
            renderContent(type);
            
            // Setup lazy loading for new content
            setTimeout(setupLazyLoading, 100);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        const backToTopButton = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Image loading with retry logic
        function handleImageError(img) {
            const retryCount = parseInt(img.getAttribute('data-retry-count')) || 0;
            const maxRetries = 3;
            
            if (retryCount < maxRetries) {
                // Retry loading after a delay
                setTimeout(() => {
                    img.setAttribute('data-retry-count', retryCount + 1);
                    img.src = img.getAttribute('data-src') + '?retry=' + retryCount;
                }, 1000 * (retryCount + 1)); // Exponential backoff: 1s, 2s, 3s
            } else {
                // Max retries reached, show manual retry button
                const wrapper = img.parentElement;
                if (!wrapper.querySelector('.thumbnail-retry')) {
                    const retryBtn = document.createElement('button');
                    retryBtn.className = 'thumbnail-retry';
                    retryBtn.innerHTML = '🔄 Reload Image';
                    retryBtn.onclick = function(e) {
                        e.stopPropagation();
                        img.setAttribute('data-retry-count', '0');
                        img.src = img.getAttribute('data-src') + '?manual=' + Date.now();
                        retryBtn.remove();
                    };
                    wrapper.appendChild(retryBtn);
                }
                img.style.display = 'none';
            }
        }

        // Lazy loading with Intersection Observer
        function setupLazyLoading() {
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            // Add small random delay to stagger loads
                            setTimeout(() => {
                                if (img.getAttribute('data-src')) {
                                    img.src = img.getAttribute('data-src');
                                }
                            }, Math.random() * 200);
                            observer.unobserve(img);
                        }
                    });
                }, {
                    rootMargin: '50px' // Start loading slightly before entering viewport
                });

                // Observe all images with loading="lazy"
                document.querySelectorAll('img[loading="lazy"]').forEach(img => {
                    imageObserver.observe(img);
                });
            }
        }

        async function init() {
            await fetchContent('movies');
            document.getElementById('loading').style.display = 'none';
            renderContent('movies');
            setupLazyLoading();
        }

        init();
    </script>
</body>
</html>